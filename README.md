# 🌳 Yoshino Tochi Timber Price Forecast

## 概要
このアプリケーションは、栃材原木の口径、長さ、ランクを入力することで、販売価格を予測するシステムです。

## 予測モデル

### Aランク材
```
価格 = 18,000円/cm × 口径 + 120,000円/m × 長さ - 850,000円
信頼区間: ±15%
```

### Bランク材
```
価格 = 9,000円/cm × 口径 + 80,000円/m × 長さ - 380,000円
信頼区間: ±20%
```

### Cランク材
```
価格 = 100,000円（定額）
信頼区間: ±10%
```

## インストール方法

### 1. Python環境の準備
Python 3.8以上がインストールされていることを確認してください。

### 2. 必要なパッケージのインストール
```bash
pip install streamlit pandas plotly
```

## 使用方法

### 1. アプリケーションの起動
```bash
streamlit run timber_price_prediction.py
```

### 2. ブラウザでアクセス
コマンド実行後、自動的にブラウザが開きます。
手動で開く場合は、以下のURLにアクセスしてください：
```
http://localhost:8501
```

### 3. データの入力

#### 単体入力
- **No.**: 木材の番号（自動入力）
- **口径 (cm)**: 木材の口径を入力（例: 80）
- **長さ (m)**: 木材の長さを入力（例: 2.0）
- **ランク**: A、B、Cのいずれかを選択
- 「➕ 追加」ボタンをクリックすると、入力したデータが追加され、予測価格が計算されます

#### CSV一括インポート
- CSVファイルを選択してアップロード
- **インポートモード**:
  - **追加**: 既存データに追加
  - **上書き**: 既存データをクリアして新規データのみにする
- プレビュー確認後、「✅ インポート実行」ボタンでインポート
- サンプルCSVをダウンロードして編集可能

## 機能

### 1. データ入力
#### 単体データ入力
- No.、口径、長さ、ランクを入力
- 予測価格、信頼区間（上限・下限）を表示

#### CSV一括インポート
- CSVファイルから複数データを一括インポート
- 追加モード/上書きモードの選択
- データプレビュー機能
- エラー行の詳細表示
- サンプルCSVのダウンロード機能

### 2. データ一覧表示
- 追加したすべてのデータを一覧表示
- 予測価格と信頼区間を表形式で表示

### 3. データ編集機能
- **行追加**: 予測結果一覧から直接行を追加
- **行削除**: 削除したい行を選択して削除
- 編集エリアは予測結果一覧の右側に配置

### 4. 統計情報
- 総本数
- 予測合計金額
- 合計下限金額
- 合計上限金額

### 5. ランク別集計
- ランクごとの本数と合計金額
- 売上比率の円グラフ表示

### 6. データ可視化
- 口径と予測価格の散布図
- ランク別価格分布のボックスプロット

### 7. データ管理
- **CSVエクスポート**: 予測結果をCSVファイルでダウンロード
- **CSVインポート**: CSVファイルから一括インポート
- **データクリア**: すべてのデータをクリア

## ランク付け基準

### Aランク
- 口径85cm以上
- 良好な形状
- 予測売上70万円以上

### Bランク
- 口径60-84cm
- 一般的な形状
- 予測売上30-69万円

### Cランク
- 口径60cm未満
- 形状に難あり
- 定額取引が適切

## サンプルデータ

以下のようなデータを入力して動作を確認できます：

| No. | 口径(cm) | 長さ(m) | ランク |
|-----|---------|---------|--------|
| 1   | 90      | 2.2     | A      |
| 2   | 78      | 1.9     | B      |
| 3   | 86      | 2.0     | B      |
| 4   | 70      | 3.3     | B      |
| 5   | 46      | 3.0     | C      |

### CSVインポート用サンプル

アプリケーション内の「📥 サンプルダウンロード」ボタンから、
正しいフォーマットのサンプルCSVファイルをダウンロードできます。
このファイルを編集して、CSV一括インポート機能で読み込むことができます。

**CSVファイルの必須列:**
- No.
- 口径(cm)
- 長さ(m)
- ランク (A, B, C のいずれか)

## トラブルシューティング

### アプリケーションが起動しない
- Pythonのバージョンを確認してください（3.8以上が必要）
- 必要なパッケージがインストールされているか確認してください
```bash
pip install -r requirements.txt
```

### ポートが使用中のエラー
別のポートを指定して起動してください：
```bash
streamlit run timber_price_prediction.py --server.port 8502
```

### グラフが表示されない
plotlyがインストールされているか確認してください：
```bash
pip install plotly
```

### CSVインポートでエラーが出る
- CSVファイルに必須列（No., 口径(cm), 長さ(m), ランク）が含まれているか確認
- ランクの値が A, B, C のいずれかになっているか確認
- 数値列（口径、長さ）に文字が含まれていないか確認
- ファイルエンコーディングがUTF-8またはShift-JISになっているか確認

## 注意事項

- 予測価格は2024年12月時点のモデルに基づいています
- 市場動向により実際の価格と乖離する可能性があります
- 定期的なデータ検証とモデルの更新を推奨します

## バージョン情報

- バージョン: 1.2
- 最終更新: 2025年11月13日
- 予測モデル: 重回帰分析（2024年12月版）

### 更新履歴

#### v1.2 (2025-11-13)
- アプリケーションタイトルを英語表記に変更
- タブベースのUI構成に改善
- データ検証機能の追加
- 統計分析タブの追加
- グラフ表示の種類追加（散布図、ボックスプロット、ヒストグラム）
- 詳細統計情報の表示機能追加

#### v1.1 (2025-11-10)
- CSV一括インポート機能を追加
- 予測結果一覧の行追加・削除機能を追加
- サンプルCSVダウンロード機能を追加
- データ編集機能の強化

#### v1.0 (2025-11-10)
- 初回リリース
- 基本的な価格予測機能
- データ可視化機能
- CSVエクスポート機能

## ライセンス

このアプリケーションは内部使用を目的としています。

## お問い合わせ

ご質問やフィードバックがございましたら、担当者までご連絡ください。
